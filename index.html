<html lang="pt-BR"><head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.13/html-to-image.min.js" integrity="sha512-iZ2ORl595Wx6miw+GuadDet4WQbdSWS3JLMoNfY8cRGoEFy6oT3G9IbcrBeL6AfkgpA51ETt/faX6yLV+/gFJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      (function() {
        const originalConsole = window.console;
        window.console = {
          log: (...args) => {
            originalConsole.log(...args);
            window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');
          },
          error: (...args) => {
            originalConsole.error(...args);
            window.parent.postMessage({ type: 'console', message: 'Error: ' + args.join(' ') }, '*');
          },
          warn: (...args) => {
            originalConsole.warn(...args);
            window.parent.postMessage({ type: 'console', message: 'Warning: ' + args.join(' ') }, '*');
          }
        };

        let requestId = 0;
        let callbacksMap = new Map();
        let streamControllers = new Map();
        
        window.claude = {
          complete: (prompt) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'claudeComplete', id, prompt }, '*');
            });
          }
        };

        window.storage = {
          get: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageGet', id, key, shared }, '*');
            });
          },
          set: (key, value, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageSet', id, key, value, shared }, '*');
            });
          },
          delete: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageDelete', id, key, shared }, '*');
            });
          },
          list: (prefix, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageList', id, prefix, shared }, '*');
            });
          }
        };

        let pendingBlobs = new Map();
        URL.createObjectURL = (blob) => {
          // Store the blob and create an ID and URL for it
          const blobId = `blob-${Date.now()}-${Math.random()}`;
          pendingBlobs.set(blobId, blob);
          return `blob-request://${blobId}`;
        };

        URL.revokeObjectURL = (url) => {
          // Remove the blob from our store
          const blobId = url.replace("blob-request://", "");
          pendingBlobs.delete(blobId);
        };

        const getBlobFromURL = (url) => {
          const blobId = url.replace("blob-request://", "");
          return pendingBlobs.get(blobId);
        };

        // Override global fetch with streaming support
        window.fetch = (url, init = {}) => {
          return new Promise((resolve, reject) => {
            const id = requestId++;
            const channelId = `fetch-${id}-${Date.now()}`;
            
            callbacksMap.set(id, { 
              resolve: (response) => {
                // Create a ReadableStream for the response body
                const stream = new ReadableStream({
                  start(controller) {
                    streamControllers.set(channelId, controller);
                  },
                  cancel() {
                    streamControllers.delete(channelId);
                  }
                });
                
                // Create and return the Response with the stream
                resolve(new Response(stream, {
                  status: response.status,
                  statusText: response.statusText,
                  headers: response.headers
                }));
              },
              reject,
              channelId
            });
            
            window.parent.postMessage({
              type: 'proxyFetch',
              id,
              url,
              init,
              channelId
            }, '*');
          });
        };

        window.addEventListener('message', async (event) => {
          if (event.data.type === 'takeScreenshot') {
            const rootElement = document.getElementById('artifacts-component-root-html');
            if (!rootElement) {
              window.parent.postMessage({
                type: 'screenshotError',
                error: new Error('Root element not found'),
              }, '*');
            }
            const screenshot = await htmlToImage.toPng(rootElement, {
              imagePlaceholder:
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII=",
            });
            window.parent.postMessage({
              type: 'screenshotData',
              data: screenshot,
            }, '*');
          } else if (event.data.type === 'claudeComplete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.completion);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'proxyFetchResponse') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
              callbacksMap.delete(event.data.id);
            } else {
              // Initial response with headers, status, etc.
              callback.resolve({
                status: event.data.status,
                statusText: event.data.statusText,
                headers: event.data.headers
              });
              // Don't delete the callback yet if streaming
              if (!event.data.body) {
                callbacksMap.delete(event.data.id);
              }
            }
          } else if (event.data.type === 'proxyFetchStream') {
            // Handle streaming data chunks
            const controller = streamControllers.get(event.data.channelId);
            if (controller) {
              if (event.data.error) {
                controller.error(new Error(event.data.error));
                streamControllers.delete(event.data.channelId);
              } else if (event.data.done) {
                controller.close();
                streamControllers.delete(event.data.channelId);
                // Clean up the callback
                const callback = Array.from(callbacksMap.entries()).find(
                  ([_, value]) => value.channelId === event.data.channelId
                );
                if (callback) {
                  callbacksMap.delete(callback[0]);
                }
              } else if (event.data.chunk) {
                controller.enqueue(new Uint8Array(event.data.chunk));
              }
            }
          } else if (event.data.type === 'storageGet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageSet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageDelete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageList') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          }
        });

        window.addEventListener('click', (event) => {
          const isEl = event.target instanceof HTMLElement;
          if (!isEl) return;
    
          // find ancestor links
          const linkEl = event.target.closest("a");
          if (!linkEl || !linkEl.href) return;
    
          event.preventDefault();
          event.stopImmediatePropagation();
    
          if (linkEl.href.startsWith("blob-request:")) {
            const blob = getBlobFromURL(linkEl.href);
            if (!blob) return;
            void blob.arrayBuffer().then((data) => {
              window.parent.postMessage({
                type: "downloadFile",
                filename: linkEl.download,
                data,
                mimeType: blob.type || "application/octet-stream",
              });
            });
          } else if (linkEl.href.startsWith("data:")) {
            const [header, base64Data] = linkEl.href.split(",");
            const mimeMatch = header.match(/data:([^;]+)/);
            const mimeType = mimeMatch ? mimeMatch[1] : "application/octet-stream";
            const binaryString = atob(base64Data);
            const data = Uint8Array.from(binaryString, (c) =>
              c.charCodeAt(0),
            ).buffer;
            window.parent.postMessage({
              type: "downloadFile",
              filename: linkEl.download,
              data,
              mimeType,
            });
          } else {
            let linkUrl;
            try {
              linkUrl = new URL(linkEl.href);
            } catch (error) {
              return;
            }
    
            if (linkUrl.hostname === window.location.hostname) return;
      
            window.parent.postMessage({
              type: 'openExternal',
              href: linkEl.href,
            }, '*');
          }
      });

        const originalOpen = window.open;
        window.open = function (url) {
          window.parent.postMessage({
            type: "openExternal",
            href: url,
          }, "*");
        };

        window.addEventListener('error', (event) => {
          window.parent.postMessage({ type: 'console', message: 'Uncaught Error: ' + event.message }, '*');
        });
      })();
    </script>
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Meta 12kg - Tracker Inteligente</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .tap-effect:active { transform: scale(0.96); transition: transform 0.1s; }
        .view-section { display: none; opacity: 0; }
        .view-section.active { display: block; opacity: 1; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.bottom-0{bottom:0px}.left-0{left:0px}.right-0{right:0px}.right-\[-30px\]{right:-30px}.top-0{top:0px}.top-\[-30px\]{top:-30px}.z-10{z-index:10}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[200\]{z-index:200}.col-span-2{grid-column:span 2 / span 2}.mx-auto{margin-left:auto;margin-right:auto}.mb-0\.5{margin-bottom:0.125rem}.mb-1{margin-bottom:0.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-0\.5{margin-top:0.125rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-12{height:3rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2\.5{height:0.625rem}.h-20{height:5rem}.h-24{height:6rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-full{height:100%}.min-h-screen{min-height:100vh}.w-12{width:3rem}.w-24{width:6rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-lg{max-width:32rem}.max-w-sm{max-width:24rem}.max-w-xs{max-width:20rem}.flex-1{flex:1 1 0%}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;user-select:none}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.gap-0\.5{gap:0.125rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-5 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.25rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-\[35px\]{border-radius:35px}.rounded-\[40px\]{border-radius:40px}.rounded-full{border-radius:9999px}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-t{border-top-width:1px}.border-emerald-500{--tw-border-opacity:1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249 / var(--tw-border-opacity, 1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-800{--tw-border-opacity:1;border-color:rgb(30 41 59 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-white\/10{border-color:rgb(255 255 255 / 0.1)}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-emerald-50{--tw-bg-opacity:1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-emerald-500{--tw-bg-opacity:1;background-color:rgb(16 185 129 / var(--tw-bg-opacity, 1))}.bg-emerald-500\/20{background-color:rgb(16 185 129 / 0.2)}.bg-emerald-600{--tw-bg-opacity:1;background-color:rgb(5 150 105 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.bg-slate-900\/40{background-color:rgb(15 23 42 / 0.4)}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/20{background-color:rgb(255 255 255 / 0.2)}.bg-white\/90{background-color:rgb(255 255 255 / 0.9)}.bg-white\/95{background-color:rgb(255 255 255 / 0.95)}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-0\.5{padding-top:0.125rem;padding-bottom:0.125rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.pb-24{padding-bottom:6rem}.pt-20{padding-top:5rem}.pt-3{padding-top:0.75rem}.pt-4{padding-top:1rem}.text-center{text-align:center}.text-right{text-align:right}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[180px\]{font-size:180px}.text-\[8px\]{font-size:8px}.text-\[9px\]{font-size:9px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.uppercase{text-transform:uppercase}.leading-none{line-height:1}.leading-tight{line-height:1.25}.tracking-tighter{letter-spacing:-0.05em}.tracking-widest{letter-spacing:0.1em}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-emerald-400{--tw-text-opacity:1;color:rgb(52 211 153 / var(--tw-text-opacity, 1))}.text-emerald-600{--tw-text-opacity:1;color:rgb(5 150 105 / var(--tw-text-opacity, 1))}.text-slate-200{--tw-text-opacity:1;color:rgb(226 232 240 / var(--tw-text-opacity, 1))}.text-slate-300{--tw-text-opacity:1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.accent-emerald-500{accent-color:#10b981}.opacity-10{opacity:0.1}.opacity-60{opacity:0.6}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-emerald-200{--tw-shadow-color:#a7f3d0;--tw-shadow:var(--tw-shadow-colored)}.shadow-emerald-500\/20{--tw-shadow-color:rgb(16 185 129 / 0.2);--tw-shadow:var(--tw-shadow-colored)}.shadow-slate-900\/20{--tw-shadow-color:rgb(15 23 42 / 0.2);--tw-shadow:var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.backdrop-blur-md{--tw-backdrop-blur:blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-1000{transition-duration:1000ms}.hover\:text-red-500:hover{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.focus\:border-emerald-500:focus{--tw-border-opacity:1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}</style></head>
<body class="text-slate-800 pb-24 select-none" id="artifacts-component-root-html">

<!-- ============================================================
     ESTADO (SISTEMA QUINE)
     ============================================================ -->
<script id="app-state">
    /* STATE_START */ 
 window.APP_DATA = {"config":{"goalKg":12,"durationDays":60,"startWeight":90,"currentWeight":90,"bmr":1800},"days":[{"day":1,"weight":90,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":2,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":3,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":4,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":5,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":6,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":7,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":8,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":9,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":10,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":11,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":12,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":13,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":14,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":15,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":16,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":17,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":18,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":19,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":20,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":21,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":22,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":23,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":24,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":25,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":26,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":27,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":28,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":29,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":30,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":31,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":32,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":33,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":34,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":35,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":36,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":37,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":38,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":39,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":40,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":41,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":42,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":43,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":44,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":45,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":46,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":47,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":48,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":49,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":50,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":51,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":52,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":53,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":54,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":55,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":56,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":57,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":58,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":59,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false},{"day":60,"weight":null,"foods":[],"activityType":null,"activityKm":0,"water":0,"electrolytes":false}]}; 
 /* STATE_END */
</script>

<!-- ============================================================
     TOP NAV
     ============================================================ -->
<div class="fixed top-0 left-0 right-0 h-16 bg-white/90 backdrop-blur-md border-b border-slate-200 z-50 flex items-center justify-between px-5 shadow-sm">
    <div onclick="switchView('settings')" class="cursor-pointer">
        <h1 class="font-black text-xl tracking-tighter text-slate-900 leading-none">META <span class="text-emerald-600" id="header-goal">12KG</span></h1>
        <p class="text-[9px] font-extrabold text-slate-400 uppercase tracking-widest mt-0.5" id="header-day">DIA 2 ‚Ä¢ 60 DIAS</p>
    </div>
    <button onclick="downloadApp()" class="bg-slate-900 text-white p-2 rounded-full tap-effect shadow-lg shadow-slate-900/20">
        <span class="material-symbols-rounded">ios_share</span>
    </button>
</div>

<!-- ============================================================
     CONTE√öDO PRINCIPAL
     ============================================================ -->
<div class="pt-20 px-4 max-w-lg mx-auto w-full min-h-screen">

    <!-- VIEW: TRACKER -->
    <div class="view-section space-y-5 active" id="view-tracker">

        <!-- Seletor de Dia -->
        <div class="flex items-center justify-between bg-white p-2 rounded-2xl shadow-sm border border-slate-200">
            <button onclick="changeDay(-1)" class="w-12 h-12 flex items-center justify-center text-slate-400 tap-effect">
                <span class="material-symbols-rounded">chevron_left</span>
            </button>
            <div class="text-center flex-1">
                <div id="day-label" class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Editando</div>
                <div class="text-2xl font-black text-slate-800">DIA <span id="display-day-num">2</span></div>
                <button id="btn-hoje" onclick="goToToday()" class="text-[9px] font-bold text-emerald-600 mt-0.5 tap-effect hidden">‚Üê Voltar ao Hoje</button>
            </div>
            <button onclick="changeDay(1)" class="w-12 h-12 flex items-center justify-center text-slate-400 tap-effect">
                <span class="material-symbols-rounded">chevron_right</span>
            </button>
        </div>

        <!-- Card de An√°lise (Gap) -->
        <div class="bg-emerald-600 rounded-3xl p-5 text-white shadow-xl relative overflow-hidden" id="gap-card">
            <div class="relative z-10">
                <h3 class="text-xs font-bold uppercase opacity-60 mb-1">An√°lise de Meta</h3>
                <p class="text-lg font-bold leading-tight" id="gap-message">Ritmo perfeito! D√©ficit atingido para o dia.</p>
                <div class="mt-4 pt-4 border-t border-white/10 flex justify-between items-end">
                    <div>
                        <span class="text-[10px] uppercase font-bold opacity-60 block">D√©ficit Hoje</span>
                        <span class="text-2xl font-black" id="today-deficit">1800 kcal</span>
                    </div>
                    <div class="text-right">
                        <span class="text-[10px] uppercase font-bold opacity-60 block">Status</span>
                        <span class="text-xs font-bold bg-white/20 px-2 py-0.5 rounded-full" id="status-badge">NO PLANO</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ingest√£o -->
        <div class="bg-white rounded-3xl p-5 shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">Ingest√£o</h2>
                <span class="text-xs font-bold text-slate-800" id="today-kcal-total">0 kcal</span>
            </div>
            <div class="grid grid-cols-4 gap-2 mb-4">
                <button onclick="openFoodModal('meat')" class="bg-slate-50 h-16 rounded-2xl flex items-center justify-center text-2xl tap-effect">ü•©</button>
                <button onclick="openFoodModal('chicken')" class="bg-slate-50 h-16 rounded-2xl flex items-center justify-center text-2xl tap-effect">üçó</button>
                <button onclick="openFoodModal('egg')" class="bg-slate-50 h-16 rounded-2xl flex items-center justify-center text-2xl tap-effect">ü•ö</button>
                <button onclick="openFoodModal('cheese')" class="bg-slate-50 h-16 rounded-2xl flex items-center justify-center text-2xl tap-effect">üßÄ</button>
            </div>
            <div id="food-log" class="space-y-2"></div>
        </div>

        <!-- Atividade (Calculadora) -->
        <div class="bg-white rounded-3xl p-5 shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">Atividade</h2>
                <span class="text-xs font-bold text-emerald-600" id="activity-kcal-label">+0 kcal</span>
            </div>

            <!-- Estado: sem atividade necess√°ria -->
            <div id="activity-no-need" class="text-center py-3">
                <p class="text-xl mb-1">üéâ</p>
                <p class="text-xs font-bold text-emerald-600">Sem atividade necess√°ria!</p>
                <p class="text-[10px] text-slate-400 mt-0.5">O seu BMR j√° cobre o d√©ficit para hoje.</p>
            </div>

            <!-- Estado: recomenda√ß√£o de atividade -->
            <div id="activity-input" class="hidden">
                <p class="text-[10px] text-slate-500 mb-3">
                    Para atingir seu d√©ficit di√°rio voc√™ precisa queimar
                    <span class="font-bold text-slate-800" id="activity-burn-target">0</span> kcal com atividade.
                </p>
                <!-- Seletor de modalidade -->
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <button onclick="selectActivity('walk')" class="activity-btn border-2 h-14 rounded-2xl flex flex-col items-center justify-center gap-0.5 tap-effect bg-emerald-50 border-emerald-500" data-type="walk">
                        <span class="text-lg">üö∂</span>
                        <span class="text-[8px] font-black text-slate-500 uppercase">Caminhada</span>
                    </button>
                    <button onclick="selectActivity('bike')" class="activity-btn border-2 h-14 rounded-2xl flex flex-col items-center justify-center gap-0.5 tap-effect bg-slate-50 border-transparent" data-type="bike">
                        <span class="text-lg">üö≤</span>
                        <span class="text-[8px] font-black text-slate-500 uppercase">Bike</span>
                    </button>
                    <button onclick="selectActivity('treadmill')" class="activity-btn border-2 h-14 rounded-2xl flex flex-col items-center justify-center gap-0.5 tap-effect bg-slate-50 border-transparent" data-type="treadmill">
                        <span class="text-lg">üèÉ</span>
                        <span class="text-[8px] font-black text-slate-500 uppercase">Esteira</span>
                    </button>
                </div>
                <!-- Km calculado -->
                <div class="bg-slate-50 rounded-2xl p-3 text-center mb-4">
                    <span class="text-4xl font-black text-slate-800" id="activity-km-display">0.0</span>
                    <span class="text-sm font-bold text-slate-400"> km</span>
                    <p class="text-[9px] text-slate-400 mt-1">= <span id="activity-burn-display">0</span> kcal de queima</p>
                </div>
                <button onclick="confirmActivity()" class="w-full bg-slate-900 text-white h-12 rounded-2xl font-bold text-sm shadow-lg tap-effect">
                    CONFIRMAR ATIVIDADE
                </button>
            </div>

            <!-- Estado: atividade j√° registrada -->
            <div id="activity-logged" class="hidden">
                <div class="flex items-center justify-between bg-slate-50 p-3 rounded-2xl border border-slate-100">
                    <div class="flex items-center gap-3">
                        <span class="text-xl" id="logged-activity-icon">üö∂</span>
                        <div>
                            <div class="text-[11px] font-black text-slate-700" id="logged-activity-name">Caminhada</div>
                            <div class="text-[10px] text-slate-400 font-bold" id="logged-activity-detail">0 km ‚Ä¢ 0 kcal</div>
                        </div>
                    </div>
                    <button onclick="removeActivity()" class="text-slate-200 hover:text-red-500">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <!-- Alerta se insuficiente -->
                <div id="activity-warning" class="hidden mt-2 bg-blue-50 rounded-xl p-2">
                    <p class="text-[10px] font-bold text-blue-600" id="activity-warning-text">‚ö†Ô∏è Falta kcal para o d√©ficit</p>
                </div>
            </div>
        </div>

        <!-- Vitais -->
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase mb-2 block">L de √Ågua</span>
                <input type="number" id="inp-water" placeholder="0" onchange="syncData()" class="text-2xl font-black text-slate-800 w-full outline-none bg-transparent">
            </div>
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase mb-2 block">Peso (kg)</span>
                <input type="number" id="inp-weight" placeholder="00.0" onchange="syncData()" class="text-2xl font-black text-slate-800 w-full outline-none bg-transparent">
            </div>
            <div class="bg-white p-3 rounded-3xl border border-slate-200 col-span-2 flex justify-between items-center">
                <span class="text-[10px] font-bold text-slate-400 uppercase">Sais Minerais</span>
                <input type="checkbox" id="inp-elec" onchange="syncData()" class="w-6 h-6 accent-emerald-500">
            </div>
        </div>
    </div>

    <!-- VIEW: DASHBOARD -->
    <div class="view-section space-y-5" id="view-dashboard">
        <!-- Card Peso + Progresso -->
        <div class="bg-slate-900 rounded-[40px] p-8 text-white shadow-2xl relative overflow-hidden">
            <div class="absolute right-[-30px] top-[-30px] opacity-10">
                <span class="material-symbols-rounded text-[180px]">monitoring</span>
            </div>
            <div class="relative z-10">
                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Peso Atual</p>
                <h2 class="text-6xl font-black mb-6 tracking-tighter" id="dash-weight">90kg</h2>
                <div>
                    <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase mb-2">
                        <span>Progresso Meta <span id="dash-goal-val">12</span>kg</span>
                        <span id="dash-pct">0%</span>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-2.5 overflow-hidden">
                        <div class="bg-emerald-500 h-full rounded-full transition-all duration-1000" id="dash-bar" style="width:0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase block mb-1">D√©ficit Acumulado</span>
                <span class="text-lg font-black text-slate-800" id="dash-deficit-total">1800 kcal</span>
                <p class="text-[9px] text-slate-400 mt-0.5" id="dash-deficit-pct">de 92400 kcal necess√°rios</p>
            </div>
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Dias Registrados</span>
                <span class="text-lg font-black text-slate-800" id="dash-days-done">1</span>
                <p class="text-[9px] text-slate-400 mt-0.5" id="dash-days-remaining">de 60 dias no plano</p>
            </div>
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase block mb-1">M√©dia Di√°ria</span>
                <span class="text-lg font-black text-slate-800" id="dash-avg-deficit">1800 kcal</span>
                <p class="text-[9px] text-slate-400 mt-0.5" id="dash-avg-target">alvo: 1540 kcal/dia</p>
            </div>
            <div class="bg-white p-4 rounded-3xl border border-slate-200">
                <span class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Dias No Plano</span>
                <span class="text-lg font-black text-slate-800" id="dash-on-track">1</span>
                <p class="text-[9px] text-slate-400 mt-0.5" id="dash-on-track-pct">de 1 registrados</p>
            </div>
        </div>

        <!-- Gr√°fico -->
        <div class="bg-white p-5 rounded-3xl border border-slate-200 shadow-sm">
            <h3 class="text-xs font-bold text-slate-400 uppercase mb-6">Evolu√ß√£o do Peso</h3>
            <div class="h-64"><canvas id="weightChart" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas></div>
        </div>
    </div>

    <!-- VIEW: SETTINGS -->
    <div class="view-section space-y-6" id="view-settings">
        <div class="bg-white p-8 rounded-[40px] shadow-sm border border-slate-200">
            <h2 class="text-2xl font-black text-slate-900 mb-2">Configura√ß√µes</h2>
            <p class="text-sm text-slate-500 mb-8">Personalize sua meta de desafio.</p>
            <div class="space-y-5">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Meta de Perda (kg)</label>
                    <input type="number" id="cfg-goal" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-emerald-500 outline-none font-bold text-xl">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Dura√ß√£o (dias)</label>
                    <input type="number" id="cfg-days" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-emerald-500 outline-none font-bold text-xl">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Peso Inicial (kg)</label>
                    <input type="number" id="cfg-start" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-emerald-500 outline-none font-bold text-xl">
                </div>
                <button onclick="saveConfig()" class="w-full bg-emerald-600 text-white h-16 rounded-2xl font-bold text-lg shadow-xl shadow-emerald-200 tap-effect mt-4">
                    RECALCULAR TUDO
                </button>
            </div>
        </div>
        <div class="p-6 bg-slate-900 rounded-[40px] text-white">
            <h3 class="font-bold mb-2">Backup de Seguran√ßa</h3>
            <p class="text-xs text-slate-400">Seus dados s√£o salvos localmente. Use o bot√£o de download no topo para baixar o arquivo HTML com seu progresso inclu√≠do.</p>
        </div>
    </div>

</div><!-- fim main -->

<!-- ============================================================
     TAB BAR
     ============================================================ -->
<div class="fixed bottom-0 w-full bg-white/95 backdrop-blur-md border-t border-slate-200 h-20 flex justify-around items-start pt-3 z-50">
    <button onclick="switchView('tracker')" class="nav-btn flex flex-col items-center justify-center w-full tap-effect text-emerald-600" data-id="tracker">
        <span class="material-symbols-rounded text-2xl mb-0.5">edit_square</span>
        <span class="text-[9px] font-black uppercase">Registro</span>
    </button>
    <button onclick="switchView('dashboard')" class="nav-btn text-slate-300 flex flex-col items-center justify-center w-full tap-effect" data-id="dashboard">
        <span class="material-symbols-rounded text-2xl mb-0.5">donut_large</span>
        <span class="text-[9px] font-black uppercase">An√°lise</span>
    </button>
    <button onclick="switchView('settings')" class="nav-btn flex flex-col items-center justify-center w-full tap-effect text-slate-300" data-id="settings">
        <span class="material-symbols-rounded text-2xl mb-0.5">tune</span>
        <span class="text-[9px] font-black uppercase">Meta</span>
    </button>
</div>

<!-- ============================================================
     MODAL ‚Äî ALIMENTA√á√ÉO
     ============================================================ -->
<div id="modal-food" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 hidden">
    <div class="bg-white w-full max-w-sm rounded-[40px] p-8 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-3">
                <span id="m-food-icon" class="text-4xl">ü•©</span>
                <h3 id="m-food-name" class="font-black text-xl">Carne</h3>
            </div>
            <button onclick="closeFoodModal()" class="bg-slate-100 p-2 rounded-full">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <input type="number" id="m-food-qty" placeholder="0" class="w-full text-center text-6xl font-black text-slate-800 bg-transparent border-b-2 border-slate-100 focus:border-emerald-500 outline-none h-24 mb-2">
        <p class="text-center text-[10px] font-black text-slate-300 uppercase tracking-widest mb-8" id="m-food-unit">GRAMAS</p>
        <button onclick="confirmFood()" class="w-full bg-slate-900 text-white h-16 rounded-3xl font-bold text-lg shadow-xl tap-effect">CONFIRMAR</button>
    </div>
</div>

<!-- ============================================================
     MODAL ‚Äî PRIMEIRO ACESSO (SETUP)
     ============================================================ -->
<div id="setup-modal" class="fixed inset-0 z-[200] bg-slate-900 flex flex-col items-center justify-center p-8 text-center hidden">
    <div class="w-24 h-24 bg-emerald-500/20 text-emerald-400 rounded-[35px] flex items-center justify-center mb-8 animate-pulse">
        <span class="material-symbols-rounded text-5xl">flag</span>
    </div>
    <h1 class="text-4xl font-black text-white mb-2 tracking-tighter">Primeiro Acesso</h1>
    <p class="text-slate-400 mb-10 text-sm max-w-xs mx-auto">Configure seu peso atual para iniciarmos o plano de perda.</p>
    <input type="number" id="setup-weight" placeholder="00.0" class="bg-transparent border-b-2 border-slate-800 text-white text-6xl font-black text-center w-full outline-none mb-12 focus:border-emerald-500 transition-colors">
    <button onclick="initSetup()" class="w-full max-w-xs bg-emerald-500 text-white h-16 rounded-3xl font-bold text-lg shadow-xl shadow-emerald-500/20 tap-effect">INICIAR AGORA</button>
</div>

<!-- ============================================================
     SCRIPT PRINCIPAL
     ============================================================ -->
<script>
// ============================================================
// CONSTANTES
// ============================================================
const FOOD_DB = {
    meat:    { name:'Carne',  icon:'ü•©', unit:'g',    kcal:2.5  },
    chicken: { name:'Frango', icon:'üçó', unit:'g',    kcal:1.65 },
    egg:     { name:'Ovo',    icon:'ü•ö', unit:'unid', kcal:75   },
    cheese:  { name:'Queijo', icon:'üßÄ', unit:'g',    kcal:3.2  }
};

// Queima por km em cada modalidade
const ACTIVITY_DB = {
    walk:      { name:'Caminhada', icon:'üö∂', kcalPerKm:60 },
    bike:      { name:'Bike',      icon:'üö≤', kcalPerKm:35 },
    treadmill: { name:'Esteira',   icon:'üèÉ', kcalPerKm:70 }
};

// ============================================================
// ESTADO INTERNO
// ============================================================
let currentDay           = 1;   // dia que o usu√°rio est√° editando
let todayDay             = 1;   // dia "real" (primeiro dia sem dados)
let selectedFood         = null;
let selectedActivityType = 'walk';
let currentNeededBurn    = 0;   // kcal de atividade necess√°rios hoje
let currentDailyTarget   = 0;   // d√©ficit di√°rio alvo
let weightChart          = null;

// ============================================================
// CICLO DE VIDA
// ============================================================
document.addEventListener('DOMContentLoaded', () => {
    // 1) Carregar localStorage
    const saved = localStorage.getItem('meta_pwa_data');
    if (saved) {
        try { window.APP_DATA = JSON.parse(saved); } catch(e) { /* ignora */ }
    }

    // 2) Migra√ß√£o: formato antigo (walkKm) ‚Üí novo (activityType + activityKm)
    if (window.APP_DATA.days.length > 0 && 'walkKm' in window.APP_DATA.days[0]) {
        window.APP_DATA.days.forEach(d => {
            d.activityType = d.walkKm > 0 ? 'walk' : null;
            d.activityKm   = d.walkKm || 0;
            delete d.walkKm;
        });
        saveAndSync();
    }

    // 3) Garantir campos existem em todos os dias
    window.APP_DATA.days.forEach(d => {
        if (d.activityType === undefined) d.activityType = null;
        if (d.activityKm   === undefined) d.activityKm   = 0;
    });

    // 4) Fluxo de entrada
    if (window.APP_DATA.config.startWeight === 0) {
        document.getElementById('setup-modal').classList.remove('hidden');
    } else {
        initApp();
    }
});

function initApp() {
    // "Hoje" = primeiro dia sem nenhum dado registrado
    const idx = window.APP_DATA.days.findIndex(d =>
        !d.weight && d.foods.length === 0 && !d.activityKm
    );
    todayDay   = idx === -1 ? window.APP_DATA.config.durationDays : idx + 1;
    currentDay = todayDay;
    updateUI();
    initChart();
}

function initSetup() {
    const w = parseFloat(document.getElementById('setup-weight').value);
    if (!w) return;
    window.APP_DATA.config.startWeight   = w;
    window.APP_DATA.config.currentWeight = w;
    window.APP_DATA.days[0].weight       = w;
    document.getElementById('setup-modal').classList.add('hidden');
    saveAndSync();
    initApp();
}

// ============================================================
// PERSIST√äNCIA
// ============================================================
function saveAndSync() {
    localStorage.setItem('meta_pwa_data', JSON.stringify(window.APP_DATA));
}

function syncData() {
    const d = window.APP_DATA.days[currentDay - 1];
    d.water        = parseFloat(document.getElementById('inp-water').value)  || 0;
    d.weight       = parseFloat(document.getElementById('inp-weight').value) || null;
    d.electrolytes = document.getElementById('inp-elec').checked;
    recalcCurrentWeight();
    saveAndSync();
    updateUI();
}

// Recalcula currentWeight como o peso mais recente registrado
function recalcCurrentWeight() {
    for (let i = window.APP_DATA.days.length - 1; i >= 0; i--) {
        if (window.APP_DATA.days[i].weight) {
            window.APP_DATA.config.currentWeight = window.APP_DATA.days[i].weight;
            return;
        }
    }
}

function saveConfig() {
    const g = parseFloat(document.getElementById('cfg-goal').value);
    const d = parseInt(document.getElementById('cfg-days').value);
    const s = parseFloat(document.getElementById('cfg-start').value);
    if (!g || !d || !s) return;

    window.APP_DATA.config.goalKg       = g;
    window.APP_DATA.config.durationDays = d;
    window.APP_DATA.config.startWeight  = s;

    // Expandir dias se necess√°rio
    if (d > window.APP_DATA.days.length) {
        for (let i = window.APP_DATA.days.length; i < d; i++) {
            window.APP_DATA.days.push({
                day: i+1, weight: null, foods: [],
                activityType: null, activityKm: 0,
                water: 0, electrolytes: false
            });
        }
    }
    // Cortar dias se necess√°rio
    if (d < window.APP_DATA.days.length) {
        window.APP_DATA.days = window.APP_DATA.days.slice(0, d);
    }

    window.APP_DATA.days[0].weight = s;
    recalcCurrentWeight();
    saveAndSync();
    initApp();
    alert('Meta atualizada! Todo o plano foi recalculado.');
    switchView('tracker');
}

// ============================================================
// GAP ANALYZER ‚Äî THE BRAIN
// ============================================================
function getActivityBurn(day) {
    if (!day.activityType || !day.activityKm) return 0;
    const db = ACTIVITY_DB[day.activityType];
    return db ? day.activityKm * db.kcalPerKm : 0;
}

function analyzeGap(totalFoodKcal) {
    const cfg           = window.APP_DATA.config;
    const totalKcalGoal = cfg.goalKg * 7700; // 7700 kcal ‚âà 1 kg

    // Somar d√©ficit dos dias ANTERIORES ao dia editado
    let deficitAccumulated = 0;
    let daysPassed         = 0;

    window.APP_DATA.days.forEach(d => {
        if (d.day < currentDay) {
            const kIn     = d.foods.reduce((a, f) => a + f.kcal, 0);
            const actBurn = getActivityBurn(d);
            deficitAccumulated += (cfg.bmr + actBurn) - kIn;
            daysPassed++;
        }
    });

    // Dados do dia atual (editado)
    const todayData    = window.APP_DATA.days[currentDay - 1];
    const todayActBurn = getActivityBurn(todayData);
    const todayDeficit = (cfg.bmr + todayActBurn) - totalFoodKcal;

    // Alvo di√°rio restante
    const remainingKcal = totalKcalGoal - deficitAccumulated;
    const remainingDays = cfg.durationDays - daysPassed;
    const dailyTarget   = remainingDays > 0 ? remainingKcal / remainingDays : remainingKcal;

    // Queima necess√°ria: dailyTarget = BMR + actBurn - foodIn
    //                    actBurn      = dailyTarget - BMR + foodIn
    const neededBurn = Math.max(0, dailyTarget - cfg.bmr + totalFoodKcal);

    // Persistir para a se√ß√£o de atividade
    currentNeededBurn  = neededBurn;
    currentDailyTarget = dailyTarget;

    // --- Atualizar card do gap ---
    const msgEl   = document.getElementById('gap-message');
    const badgeEl = document.getElementById('status-badge');
    const cardEl  = document.getElementById('gap-card');

    if (todayDeficit >= dailyTarget) {
        msgEl.innerText   = 'Ritmo perfeito! D√©ficit atingido para o dia.';
        badgeEl.innerText = 'NO PLANO';
        cardEl.className  = 'bg-emerald-600 rounded-3xl p-5 text-white shadow-xl relative overflow-hidden';
    } else {
        const gap    = Math.round(dailyTarget - todayDeficit);
        const hasAct = todayData.activityType && todayData.activityKm > 0;
        msgEl.innerText = hasAct
            ? `Atividade registrada, mas falta +${gap} kcal de d√©ficit. Ajuste se necess√°rio.`
            : `Adicione atividade para cobrir os +${gap} kcal de d√©ficit restantes.`;
        badgeEl.innerText = 'ATRASO';
        cardEl.className  = 'bg-blue-600 rounded-3xl p-5 text-white shadow-xl relative overflow-hidden';
    }

    document.getElementById('today-deficit').innerText = Math.round(todayDeficit) + ' kcal';

    return { todayDeficit, dailyTarget, neededBurn };
}

// ============================================================
// ATIVIDADE
// ============================================================
function selectActivity(type) {
    selectedActivityType = type;
    refreshActivityButtons();
    refreshActivityKmDisplay();
}

function refreshActivityButtons() {
    document.querySelectorAll('.activity-btn').forEach(btn => {
        const on = btn.dataset.type === selectedActivityType;
        btn.classList.toggle('bg-emerald-50',       on);
        btn.classList.toggle('border-emerald-500',  on);
        btn.classList.toggle('bg-slate-50',        !on);
        btn.classList.toggle('border-transparent', !on);
    });
}

function refreshActivityKmDisplay() {
    const rate     = ACTIVITY_DB[selectedActivityType].kcalPerKm;
    const neededKm = currentNeededBurn > 0 ? currentNeededBurn / rate : 0;
    document.getElementById('activity-km-display').innerText   = neededKm.toFixed(1);
    document.getElementById('activity-burn-display').innerText = Math.round(currentNeededBurn);
}

function confirmActivity() {
    const rate = ACTIVITY_DB[selectedActivityType].kcalPerKm;
    const km   = currentNeededBurn > 0 ? currentNeededBurn / rate : 0;

    const day        = window.APP_DATA.days[currentDay - 1];
    day.activityType = selectedActivityType;
    day.activityKm   = parseFloat(km.toFixed(1));

    saveAndSync();
    updateUI();
    playSound();
}

function removeActivity() {
    const day        = window.APP_DATA.days[currentDay - 1];
    day.activityType = null;
    day.activityKm   = 0;
    saveAndSync();
    updateUI();
}

function updateActivitySection() {
    const day    = window.APP_DATA.days[currentDay - 1];
    const hasAct = day.activityType && day.activityKm > 0;

    const inputEl   = document.getElementById('activity-input');
    const noNeedEl  = document.getElementById('activity-no-need');
    const loggedEl  = document.getElementById('activity-logged');
    const kcalLabel = document.getElementById('activity-kcal-label');

    if (hasAct) {
        // --- Atividade j√° registrada ---
        inputEl.classList.add('hidden');
        noNeedEl.classList.add('hidden');
        loggedEl.classList.remove('hidden');

        const act  = ACTIVITY_DB[day.activityType];
        const burn = getActivityBurn(day);
        document.getElementById('logged-activity-icon').innerText   = act.icon;
        document.getElementById('logged-activity-name').innerText   = act.name;
        document.getElementById('logged-activity-detail').innerText = `${day.activityKm} km ‚Ä¢ ${Math.round(burn)} kcal`;
        kcalLabel.innerText = `+${Math.round(burn)} kcal`;

        // Alerta se insuficiente
        const foodKcal     = day.foods.reduce((a, f) => a + f.kcal, 0);
        const todayDeficit = (window.APP_DATA.config.bmr + burn) - foodKcal;
        const warningEl    = document.getElementById('activity-warning');
        if (todayDeficit < currentDailyTarget) {
            const shortfall = Math.round(currentDailyTarget - todayDeficit);
            warningEl.classList.remove('hidden');
            document.getElementById('activity-warning-text').innerText =
                `‚ö†Ô∏è Falta +${shortfall} kcal ‚Äî remova e reajuste a atividade`;
        } else {
            warningEl.classList.add('hidden');
        }

    } else if (currentNeededBurn <= 0) {
        // --- Sem atividade necess√°ria ---
        inputEl.classList.add('hidden');
        loggedEl.classList.add('hidden');
        noNeedEl.classList.remove('hidden');
        kcalLabel.innerText = '+0 kcal';

    } else {
        // --- Recomenda√ß√£o de atividade ---
        noNeedEl.classList.add('hidden');
        loggedEl.classList.add('hidden');
        inputEl.classList.remove('hidden');

        document.getElementById('activity-burn-target').innerText = Math.round(currentNeededBurn);
        kcalLabel.innerText = `+${Math.round(currentNeededBurn)} kcal`;
        refreshActivityButtons();
        refreshActivityKmDisplay();
    }
}

// ============================================================
// UI ENGINE
// ============================================================
function updateUI() {
    const cfg = window.APP_DATA.config;
    const day = window.APP_DATA.days[currentDay - 1];

    // --- Indicador de dia passado ---
    const dayLabel = document.getElementById('day-label');
    const btnHoje  = document.getElementById('btn-hoje');
    if (currentDay < todayDay) {
        dayLabel.innerText = 'Editando (dia passado)';
        dayLabel.className = 'text-[10px] font-bold text-blue-500 uppercase tracking-tighter';
        btnHoje.classList.remove('hidden');
    } else {
        dayLabel.innerText = 'Editando';
        dayLabel.className = 'text-[10px] font-bold text-slate-400 uppercase tracking-tighter';
        btnHoje.classList.add('hidden');
    }

    // --- Header ---
    document.getElementById('header-goal').innerText     = cfg.goalKg + 'KG';
    document.getElementById('header-day').innerText      = `DIA ${currentDay} ‚Ä¢ ${cfg.durationDays} DIAS`;
    document.getElementById('display-day-num').innerText = currentDay;

    // --- Inputs do tracker ---
    document.getElementById('inp-water').value  = day.water  || '';
    document.getElementById('inp-weight').value = day.weight || '';
    document.getElementById('inp-elec').checked = day.electrolytes;

    // --- Inputs do settings ---
    document.getElementById('cfg-goal').value  = cfg.goalKg;
    document.getElementById('cfg-days').value  = cfg.durationDays;
    document.getElementById('cfg-start').value = cfg.startWeight;

    // --- Lista de alimentos ---
    const listEl  = document.getElementById('food-log');
    listEl.innerHTML = '';
    let totalKcal = 0;

    day.foods.forEach(f => {
        totalKcal += f.kcal;
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center bg-slate-50 p-3 rounded-2xl border border-slate-100';
        div.innerHTML = `
            <div class="flex items-center gap-3">
                <span class="text-xl">${f.icon}</span>
                <div>
                    <div class="text-[11px] font-black text-slate-700">${f.name}</div>
                    <div class="text-[10px] text-slate-400 font-bold">${f.qty}${f.unit} ‚Ä¢ ${Math.round(f.kcal)} kcal</div>
                </div>
            </div>
            <button onclick="removeFood(${f.id})" class="text-slate-200 hover:text-red-500">
                <span class="material-symbols-rounded">close</span>
            </button>`;
        listEl.appendChild(div);
    });
    document.getElementById('today-kcal-total').innerText = Math.round(totalKcal) + ' kcal';

    // --- Gap (seta currentNeededBurn + currentDailyTarget) ---
    analyzeGap(totalKcal);

    // --- Se√ß√£o de atividade ---
    updateActivitySection();

    // --- Dashboard: peso + progresso ---
    document.getElementById('dash-weight').innerText   = cfg.currentWeight + 'kg';
    document.getElementById('dash-goal-val').innerText = cfg.goalKg;
    const lost = cfg.startWeight - cfg.currentWeight;
    const pct  = Math.min(100, Math.max(0, (lost / cfg.goalKg) * 100));
    document.getElementById('dash-pct').innerText      = Math.round(pct) + '%';
    document.getElementById('dash-bar').style.width    = pct + '%';

    // --- Dashboard: stats ---
    updateDashStats();

    // --- Gr√°fico ---
    updateChart();
}

function updateDashStats() {
    const cfg           = window.APP_DATA.config;
    const totalKcalGoal = cfg.goalKg * 7700;
    let totalDeficit    = 0;
    let daysDone        = 0;
    let daysOnTrack     = 0;
    let runningDeficit  = 0;

    window.APP_DATA.days.forEach((d, idx) => {
        const hasData = d.foods.length > 0 || d.activityKm > 0 || d.weight;
        if (!hasData) return;

        const kIn     = d.foods.reduce((a, f) => a + f.kcal, 0);
        const actBurn = getActivityBurn(d);
        const deficit = (cfg.bmr + actBurn) - kIn;

        // Alvo naquele ponto no tempo
        const remainAtPoint  = totalKcalGoal - runningDeficit;
        const daysAtPoint    = cfg.durationDays - idx;
        const targetAtPoint  = daysAtPoint > 0 ? remainAtPoint / daysAtPoint : remainAtPoint;

        if (deficit >= targetAtPoint) daysOnTrack++;

        runningDeficit += deficit;
        totalDeficit   += deficit;
        daysDone++;
    });

    document.getElementById('dash-deficit-total').innerText  = Math.round(totalDeficit) + ' kcal';
    document.getElementById('dash-deficit-pct').innerText    = `de ${Math.round(totalKcalGoal)} kcal necess√°rios`;
    document.getElementById('dash-days-done').innerText      = daysDone;
    document.getElementById('dash-days-remaining').innerText = `de ${cfg.durationDays} dias no plano`;

    const avgDeficit  = daysDone > 0 ? totalDeficit / daysDone : 0;
    const idealDaily  = totalKcalGoal / cfg.durationDays;
    document.getElementById('dash-avg-deficit').innerText  = daysDone > 0 ? Math.round(avgDeficit) + ' kcal' : '‚Äî kcal';
    document.getElementById('dash-avg-target').innerText   = `alvo: ${Math.round(idealDaily)} kcal/dia`;
    document.getElementById('dash-on-track').innerText     = daysOnTrack;
    document.getElementById('dash-on-track-pct').innerText = `de ${daysDone} registrados`;
}

// --- Navega√ß√£o ---
function switchView(view) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.getElementById('view-' + view).classList.add('active');

    document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.remove('text-emerald-600');
        b.classList.add('text-slate-300');
    });
    const activeBtn = document.querySelector(`.nav-btn[data-id="${view}"]`);
    if (activeBtn) {
        activeBtn.classList.remove('text-slate-300');
        activeBtn.classList.add('text-emerald-600');
    }

    // Garantir dashboard sempre atualizado ao entrar
    if (view === 'dashboard') updateUI();
}

function changeDay(delta) {
    const n = currentDay + delta;
    if (n >= 1 && n <= window.APP_DATA.config.durationDays) {
        currentDay = n;
        updateUI();
    }
}

function goToToday() {
    currentDay = todayDay;
    updateUI();
}

// ============================================================
// ALIMENTA√á√ÉO
// ============================================================
function openFoodModal(type) {
    selectedFood = FOOD_DB[type];
    document.getElementById('m-food-icon').innerText = selectedFood.icon;
    document.getElementById('m-food-name').innerText = selectedFood.name;
    document.getElementById('m-food-unit').innerText = selectedFood.unit === 'g' ? 'GRAMAS' : 'UNIDADES';
    document.getElementById('m-food-qty').value      = selectedFood.unit === 'g' ? 100 : 2;
    document.getElementById('modal-food').classList.remove('hidden');
}

function closeFoodModal() {
    document.getElementById('modal-food').classList.add('hidden');
}

function confirmFood() {
    const qty = parseFloat(document.getElementById('m-food-qty').value);
    if (!qty) return;

    window.APP_DATA.days[currentDay - 1].foods.push({
        id:   Date.now(),
        name: selectedFood.name,
        icon: selectedFood.icon,
        unit: selectedFood.unit,
        qty:  qty,
        kcal: qty * selectedFood.kcal
    });

    closeFoodModal();
    saveAndSync();
    updateUI();
    playSound();
}

function removeFood(id) {
    const d = window.APP_DATA.days[currentDay - 1];
    d.foods = d.foods.filter(f => f.id !== id);
    saveAndSync();
    updateUI();
}

// ============================================================
// GR√ÅFICO (Chart.js)
// ============================================================
function initChart() {
    const ctx = document.getElementById('weightChart').getContext('2d');
    weightChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                data: [],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16,185,129,0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 4,
                pointRadius: 5,
                pointBackgroundColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                x: { display: false },
                y: { grid: { color:'#f1f5f9' }, ticks: { font: { size:10, weight:'bold' } } }
            }
        }
    });
}

function updateChart() {
    if (!weightChart) return;
    const labels = [], data = [];
    window.APP_DATA.days.forEach(d => {
        if (d.weight || d.day === 1) {
            labels.push(d.day);
            data.push(d.weight || window.APP_DATA.config.startWeight);
        }
    });
    weightChart.data.labels           = labels;
    weightChart.data.datasets[0].data = data;
    weightChart.update();
}

// ============================================================
// SOM
// ============================================================
function playSound() {
    try {
        const synth = new Tone.Synth().toDestination();
        synth.triggerAttackRelease('G5','32n');
    } catch(e) { /* sil√™ncio se indispon√≠vel */ }
}

// ============================================================
// QUINE DOWNLOAD ‚Äî salva estado dentro do pr√≥prio HTML
// ============================================================
function downloadApp() {
    saveAndSync();
    const state = JSON.stringify(window.APP_DATA);
    let html    = document.documentElement.outerHTML;
    const regex = /\/\* STATE_START \*\/[\s\S]*?\/\* STATE_END \*\//;
    const replacement = `/* STATE_START */ \n window.APP_DATA = ${state}; \n /* STATE_END */`;
    html = html.replace(regex, replacement);

    const blob = new Blob([html], { type:'text/html' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href     = url;
    a.download = 'index.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    alert('Arquivo index.html pronto para upload no GitHub!');
}
</script>


</body></html>